<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
<title>Withings Bodyの計測結果を取得した | DC5</title>



<meta property="og:title" content="Withings Bodyの計測結果を取得した">




<meta property="og:locale" content="en_US">




<link rel="canonical" href="https://blog.yasun.dev/withings-api/">
<meta property="og:url" content="https://blog.yasun.dev/withings-api/">



<meta property="og:site_name" content="DC5" />



  <meta property="og:image" content="https://blog.yasun.dev/tale.png">
  
  



  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2022-02-20T12:00:00+00:00">







  <meta name="twitter:card" content="summary_large_image"">
  <meta property="twitter:image" content="https://blog.yasun.dev/tale.png">



  <meta property="twitter:title" content="Withings Bodyの計測結果を取得した">





  

  

  



  

  

  

  

  


<script type="application/ld+json">
{
  "author": {
    "@type":"Person",
	  "name":"",
  },
  "description": "",
  "url": "https://blog.yasun.dev/withings-api/",
  "@context":"https://schema.org",
  "@type": "BlogPosting",
  "headline": "Withings Bodyの計測結果を取得した"
  
    
    
      "datePublished":"2022-02-20T12:00:00+00:00",
    
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://blog.yasun.dev/withings-api/"
    },
  
}
</script>

  <link rel="stylesheet" href="https://blog.yasun.dev/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <link rel="icon" type="image/png" sizes="32x32" href="https://blog.yasun.dev/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://blog.yasun.dev/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://blog.yasun.dev/assets/apple-touch-icon.png">

  
    <link type="application/atom+xml" rel="alternate" href="https://blog.yasun.dev/atom.xml" title="DC5" />
  

  

  
  
</head>

<body>
  
  <nav class="nav">
    <div class="nav-container">
      <a href="https://blog.yasun.dev/">
        <h2 class="nav-title">DC5</h2>
      </a>
      <ul>
        
          
            <li><a href="https://blog.yasun.dev">Posts</a></li>
          
            <li><a href="https://blog.yasun.dev/tags">Tags</a></li>
          
            <li><a href="https://blog.yasun.dev/about">About</a></li>
          
        
      </ul>
    </div>
  </nav>
  

  <main>
    
  <div class="post">
  	<div class="post-info">
  		
  		<span>on&nbsp;</span><time datetime="2022-02-20T12:00:00+00:00">February 20, 2022</time>
  	</div>
  	<h1 class="post-title">Withings Bodyの計測結果を取得した</h1>
  	<div class="post-line"></div>
  	<p>今年から筋トレを開始し、知人に勧められた<code>Withings Body</code>を購入した。</p>
<h1 id="withings-body">Withings Body</h1>
<p><a href="https://www.withings.com/jp/ja/scales">https://www.withings.com/jp/ja/scales</a></p>
<ul>
<li>WiFi/Bluetoothに接続できるスマート体重計。</li>
<li>専用アプリをインストールすることで体重や体脂肪等のダッシュボードを見ることができる。</li>
<li>面白い点としてOAuth認証でWebAPIが公開されていて計測結果の情報に自由にアクセスできる。</li>
</ul>
<h1 id="apidedekirukoto">APIでできること</h1>
<p>計測した結果は殆どアクセスできる。
睡眠パッドやウォッチのAPIも含まれているため色々なエントリポイントがある。
<a href="https://developer.withings.com/api-reference">api-reference</a></p>
<p>体重計の情報の取得に必要なAPIは以下。</p>
<ul>
<li><a href="https://developer.withings.com/api-reference#tag/oauth2">OAuth2</a></li>
<li><a href="https://developer.withings.com/api-reference#tag/measure">Measure</a></li>
</ul>
<h2 id="api-keytosecretnoqu-de">API KeyとSecretの取得</h2>
<p>API利用のためには以下からアプリを作成してAPI KeyとSecretの取得する必要がある。
<a href="https://oauth.withings.com/">https://oauth.withings.com/</a></p>
<h2 id="authentication-codenoqu-de">Authentication Codeの取得</h2>
<p><a href="https://developer.withings.com/api-reference#operation/oauth2-authorize">oauth2-authorize</a></p>
<p>以下URLにGetでアクセスすることで<code>authentication code</code>を取得できる。</p>
<pre style="background-color:#eff1f5;color:#4f5b66;"><code><span>https://account.withings.com/oauth2_user/authorize2?response_type=code&amp;client_id=`your_client_id`&amp;redirect_uri=https%3A%2F%2Flocalhost&amp;scope=user.info%2Cuser.metrics&amp;state=demo
</span></code></pre>
<p>今回はCLIから利用を想定しているので<code>redirect_uri</code>にlocalhostに指定してリダイレクトされたURLパラメータから<code>code</code>を取得した。</p>
<p><code>code</code>の有効期限は30秒しかないので注意。</p>
<h2 id="access-tokennoqu-de">Access Tokenの取得</h2>
<p><a href="https://oauth.withings.com/api-reference#operation/oauth2-getaccesstoken">oauth2-getaccesstoken</a></p>
<p>以下URLにPOSTでアクセスすることで<code>Access Token</code>を取得できる。</p>
<pre style="background-color:#eff1f5;color:#4f5b66;"><code><span>curl --data &quot;action=requesttoken&amp;grant_type=authorization_code&amp;client_id=`your_client_id`&amp;client_secret=`your_client_secret`&amp;code=`上記で取得したauthentication_code`&amp;redirect_uri=http://localhost/&quot; &#39;https://wbsapi.withings.net/v2/oauth2&#39;
</span></code></pre>
<p><code>action</code>と<code>authorization_code</code>は固定の文字列が入る。</p>
<h2 id="measureqing-bao-noqu-de">Measure情報の取得</h2>
<p><a href="https://developer.withings.com/api-reference#operation/measure-getmeas">measure-getmeas</a></p>
<p>以下URLにPOSTでアクセスすることで<code>Measure情報</code>を取得できる。</p>
<pre style="background-color:#eff1f5;color:#4f5b66;"><code><span>curl --header &quot;Authorization: Bearer `上記で取得したAccess Token`&quot; --data &quot;action=getmeas&amp;meastype=1&amp;category=1&quot; &#39;https://wbsapi.withings.net/measure&#39;
</span></code></pre>
<p>パラメータで指定できる項目が沢山あるが、体重取得時に使うパラメータは以下で良さそう。</p>
<pre style="background-color:#eff1f5;color:#4f5b66;"><code><span>meastype: 1 // Weight (kg)
</span><span>category: 1 // for real measures
</span><span>startdate: `unix time` // Measures&#39; start date.
</span><span>enddate:   `unix time` // Measures&#39; end date
</span></code></pre>
<p>体脂肪など他の情報も同時に取得したい場合は<code>meastype</code>の代わりに<code>meastypes</code>を使用使用する。</p>
<pre style="background-color:#eff1f5;color:#4f5b66;"><code><span>meastypes=1,6
</span></code></pre>
<h1 id="rustdeapinokuraiantoraiburariwozuo-tuta">RustでAPIのクライアントライブラリを作った</h1>
<p>結構な頻度でトークンの再取得/リフレッシュを行う必要があり大変だったのでRustでAPIクライアントを作った。
<a href="https://github.com/yassun/withings-api">https://github.com/yassun/withings-api</a></p>
<p>こちらを使って定期的に<code>Getmeas</code>を呼ぶことでSlackやLineに最新の測定結果を通知することが可能になった。</p>

  </div>

	

  <div class="pagination">
  	
		<a href="#" class="top">Top</a>
		
  </div>

  </main>

  
  <footer>
    <span>&copy; <time datetime="2023-01-04T00:41:45.344649+09:00">2021-2023</time> . Made with <a href="https://www.getzola.org">Zola</a> with <a href="https://github.com/aaranxu/tale-zola">Tala-Zola</a> theme.</span>
  </footer>
  
</body>
</html>
